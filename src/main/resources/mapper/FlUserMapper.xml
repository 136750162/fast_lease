<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fl.fastLease.mapper.FlUserMapper">

    <resultMap type="com.fl.fastLease.model.FlUser" id="userResult">
        <result property="id" column="id"/>
        <result property="openId" column="open_id"/>
        <result property="unionId" column="union_id"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="nikeName" column="nike_name"/>
        <result property="image" column="image"/>
        <result property="gender" column="gender"/>
        <result property="country" column="country"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <sql id="column">
        id,
        open_id,
        union_id,
        phone,
        email,
        nike_name,
        image,
        gender,
        country,
        province,
        city,
        create_time
    </sql>




    <select id="getUser" resultMap="userResult">
        select
        <include refid="column"/>
        from fl_user where open_id = #{openId}
    </select>


    <insert id="insertOrUpdate">
        insert into fl_user(
            open_id,
            union_id,
            phone,
            email,
            nike_name,
            image,
            gender,
            country,
            province,
            city
        )
        values(
          #{open_id},
          #{union_id},
          #{phone},
          #{email},
          #{nike_name},
          #{image},
          #{gender},
          #{country},
          #{province},
          #{city}
        )
        ON DUPLICATE KEY UPDATE
         phone = values(phone),
         email = values(email),
         nike_name = values(nike_name),
         image = values(image),
         gender = values(gender),
         country = values(country),
         province = values(province),
         city= values(city)
    </insert>

    <update id="update">
        update fl_user set
        <set>
            <trim suffixOverrides=",">
                <if test="phone != null and phone != ''">
                    phone = #{phone},
                </if>
                <if test="email != null and email != ''">
                    email = #{email},
                </if>
                <if test="nikeName != null and nikeName != ''">
                    nike_name = #{nikeName},
                </if>
                <if test="image != null and image != ''">
                    image = #{image},
                </if>
                <if test="gender != null">
                    gender = #{gender},
                </if>
                <if test="country != null and country != ''">
                    country = #{country},
                </if>
                <if test="province != null and province != ''">
                    province = #{province},
                </if>
                <if test="city != null and city != ''">
                    city = #{city},
                </if>
            </trim>
        </set>
        where id = #{id}
    </update>
</mapper>
